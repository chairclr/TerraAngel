using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Threading.Tasks;
using Microsoft.Xna.Framework;
using Terraria;

namespace TerraAngel.Utility
{
    public class TileUtil
    {
        // MOVE THESE TO ARRAYS LATER????????????????????????? OK????????????????
        public static Dictionary<int, int> TileToItem = new Dictionary<int, int>() { { 0, 2 }, { 1, 3 }, { 4, 8 }, { 30, 9 }, { 6, 11 }, { 7, 12 }, { 8, 13 }, { 9, 14 }, { 239, 19 }, { 10, 25 }, { 20, 27 }, { 13, 31 }, { 14, 32 }, { 17, 33 }, { 15, 34 }, { 16, 35 }, { 18, 36 }, { 21, 48 }, { 105, 52 }, { 22, 56 }, { 23, 59 }, { 25, 61 }, { 2, 62 }, { 27, 63 }, { 330, 71 }, { 331, 72 }, { 332, 73 }, { 333, 74 }, { 214, 85 }, { 29, 87 }, { 19, 94 }, { 33, 105 }, { 34, 106 }, { 37, 116 }, { 38, 129 }, { 39, 131 }, { 40, 133 }, { 41, 134 }, { 42, 136 }, { 43, 137 }, { 44, 139 }, { 45, 141 }, { 46, 143 }, { 47, 145 }, { 48, 147 }, { 49, 148 }, { 50, 149 }, { 51, 150 }, { 53, 169 }, { 54, 170 }, { 55, 171 }, { 57, 172 }, { 56, 173 }, { 58, 174 }, { 59, 176 }, { 178, 177 }, { 190, 183 }, { 75, 192 }, { 70, 194 }, { 60, 195 }, { 76, 214 }, { 77, 221 }, { 78, 222 }, { 79, 224 }, { 282, 250 }, { 81, 275 }, { 188, 276 }, { 82, 307 }, { 85, 321 }, { 86, 332 }, { 87, 333 }, { 88, 334 }, { 89, 335 }, { 90, 336 }, { 91, 337 }, { 92, 341 }, { 93, 342 }, { 95, 344 }, { 96, 345 }, { 97, 346 }, { 98, 347 }, { 100, 349 }, { 94, 352 }, { 101, 354 }, { 102, 355 }, { 103, 356 }, { 104, 359 }, { 106, 363 }, { 107, 364 }, { 108, 365 }, { 111, 366 }, { 109, 369 }, { 112, 370 }, { 114, 398 }, { 116, 408 }, { 117, 409 }, { 118, 412 }, { 119, 413 }, { 120, 414 }, { 121, 415 }, { 122, 416 }, { 123, 424 }, { 349, 470 }, { 124, 480 }, { 125, 487 }, { 126, 488 }, { 470, 498 }, { 129, 502 }, { 130, 511 }, { 131, 512 }, { 132, 513 }, { 133, 524 }, { 134, 525 }, { 135, 529 }, { 136, 538 }, { 137, 539 }, { 138, 540 }, { 139, 562 }, { 140, 577 }, { 141, 580 }, { 142, 581 }, { 143, 582 }, { 144, 583 }, { 145, 586 }, { 146, 591 }, { 147, 593 }, { 148, 594 }, { 149, 596 }, { 150, 604 }, { 151, 607 }, { 152, 609 }, { 153, 611 }, { 154, 612 }, { 155, 613 }, { 156, 614 }, { 157, 619 }, { 158, 620 }, { 159, 621 }, { 160, 662 }, { 161, 664 }, { 166, 699 }, { 167, 700 }, { 168, 701 }, { 169, 702 }, { 174, 713 }, { 173, 714 }, { 175, 717 }, { 176, 718 }, { 177, 719 }, { 189, 751 }, { 193, 762 }, { 195, 763 }, { 196, 765 }, { 194, 766 }, { 197, 767 }, { 198, 775 }, { 202, 824 }, { 191, 832 }, { 163, 833 }, { 164, 834 }, { 200, 835 }, { 203, 836 }, { 204, 880 }, { 206, 883 }, { 207, 909 }, { 208, 911 }, { 209, 928 }, { 192, 933 }, { 210, 937 }, { 211, 947 }, { 212, 951 }, { 213, 965 }, { 215, 966 }, { 216, 970 }, { 217, 995 }, { 218, 996 }, { 219, 997 }, { 220, 998 }, { 226, 1101 }, { 224, 1103 }, { 221, 1104 }, { 222, 1105 }, { 223, 1106 }, { 227, 1107 }, { 228, 1120 }, { 229, 1125 }, { 230, 1127 }, { 225, 1129 }, { 232, 1150 }, { 234, 1246 }, { 235, 1263 }, { 237, 1292 }, { 272, 1344 }, { 240, 1360 }, { 241, 1417 }, { 242, 1421 }, { 243, 1430 }, { 244, 1449 }, { 245, 1474 }, { 246, 1479 }, { 247, 1551 }, { 248, 1589 }, { 249, 1591 }, { 250, 1593 }, { 251, 1725 }, { 252, 1727 }, { 253, 1729 }, { 35, 1813 }, { 254, 1828 }, { 36, 1869 }, { 170, 1872 }, { 171, 1873 }, { 262, 1970 }, { 263, 1971 }, { 264, 1972 }, { 265, 1973 }, { 266, 1974 }, { 267, 1975 }, { 268, 1976 }, { 270, 1993 }, { 271, 2005 }, { 273, 2119 }, { 274, 2120 }, { 275, 2162 }, { 276, 2163 }, { 277, 2164 }, { 278, 2165 }, { 279, 2166 }, { 280, 2167 }, { 281, 2168 }, { 199, 2171 }, { 283, 2172 }, { 284, 2173 }, { 285, 2174 }, { 286, 2175 }, { 287, 2177 }, { 288, 2178 }, { 289, 2179 }, { 290, 2180 }, { 291, 2181 }, { 292, 2182 }, { 293, 2183 }, { 294, 2184 }, { 295, 2185 }, { 296, 2186 }, { 297, 2187 }, { 298, 2190 }, { 299, 2191 }, { 300, 2192 }, { 301, 2193 }, { 302, 2194 }, { 303, 2195 }, { 304, 2196 }, { 305, 2197 }, { 306, 2198 }, { 307, 2203 }, { 308, 2204 }, { 309, 2206 }, { 310, 2207 }, { 311, 2260 }, { 312, 2261 }, { 313, 2262 }, { 376, 2334 }, { 314, 2340 }, { 315, 2435 }, { 316, 2439 }, { 317, 2440 }, { 318, 2441 }, { 319, 2490 }, { 320, 2496 }, { 321, 2503 }, { 322, 2504 }, { 324, 2625 }, { 325, 2692 }, { 326, 2693 }, { 327, 2694 }, { 328, 2695 }, { 329, 2697 }, { 471, 2699 }, { 335, 2700 }, { 336, 2701 }, { 337, 2702 }, { 338, 2738 }, { 339, 2741 }, { 340, 2751 }, { 341, 2752 }, { 342, 2753 }, { 343, 2754 }, { 344, 2755 }, { 345, 2787 }, { 346, 2792 }, { 347, 2793 }, { 348, 2794 }, { 172, 2827 }, { 350, 2860 }, { 351, 2868 }, { 353, 2996 }, { 354, 2999 }, { 355, 3000 }, { 356, 3064 }, { 357, 3066 }, { 358, 3070 }, { 359, 3071 }, { 360, 3072 }, { 361, 3073 }, { 362, 3074 }, { 363, 3075 }, { 364, 3076 }, { 365, 3077 }, { 366, 3078 }, { 367, 3081 }, { 368, 3086 }, { 369, 3087 }, { 370, 3100 }, { 371, 3113 }, { 372, 3117 }, { 373, 3182 }, { 374, 3184 }, { 375, 3185 }, { 377, 3198 }, { 378, 3202 }, { 379, 3214 }, { 380, 3215 }, { 385, 3234 }, { 387, 3239 }, { 388, 3240 }, { 390, 3253 }, { 391, 3254 }, { 392, 3255 }, { 393, 3256 }, { 394, 3257 }, { 395, 3270 }, { 396, 3271 }, { 397, 3272 }, { 398, 3274 }, { 399, 3275 }, { 400, 3276 }, { 401, 3277 }, { 402, 3338 }, { 403, 3339 }, { 404, 3347 }, { 383, 3360 }, { 384, 3361 }, { 405, 3364 }, { 406, 3365 }, { 407, 3380 }, { 408, 3460 }, { 409, 3461 }, { 410, 3536 }, { 411, 3545 }, { 412, 3549 }, { 413, 3565 }, { 414, 3566 }, { 415, 3573 }, { 416, 3574 }, { 417, 3575 }, { 418, 3576 }, { 419, 3602 }, { 420, 3603 }, { 421, 3609 }, { 422, 3610 }, { 423, 3613 }, { 424, 3616 }, { 425, 3617 }, { 426, 3621 }, { 427, 3622 }, { 428, 3626 }, { 429, 3629 }, { 430, 3633 }, { 431, 3634 }, { 432, 3635 }, { 433, 3636 }, { 434, 3637 }, { 435, 3638 }, { 436, 3639 }, { 437, 3640 }, { 438, 3641 }, { 439, 3642 }, { 440, 3644 }, { 441, 3665 }, { 442, 3707 }, { 443, 3722 }, { 445, 3725 }, { 446, 3736 }, { 447, 3737 }, { 448, 3738 }, { 449, 3739 }, { 450, 3740 }, { 451, 3741 }, { 452, 3742 }, { 453, 3743 }, { 454, 3746 }, { 455, 3747 }, { 456, 3748 }, { 457, 3749 }, { 621, 3750 }, { 458, 3754 }, { 459, 3755 }, { 460, 3756 }, { 461, 3782 }, { 462, 3795 }, { 463, 3813 }, { 464, 3814 }, { 465, 3815 }, { 466, 3816 }, { 467, 3884 }, { 468, 3886 }, { 469, 3920 }, { 472, 3951 }, { 473, 3953 }, { 474, 3955 }, { 475, 3977 }, { 476, 4040 }, { 3, 4041 }, { 478, 4050 }, { 479, 4051 }, { 480, 4054 }, { 486, 4063 }, { 487, 4064 }, { 489, 4074 }, { 490, 4075 }, { 491, 4076 }, { 493, 4083 }, { 494, 4089 }, { 495, 4090 }, { 496, 4091 }, { 497, 4096 }, { 498, 4139 }, { 499, 4142 }, { 500, 4229 }, { 501, 4230 }, { 502, 4231 }, { 503, 4232 }, { 481, 4238 }, { 482, 4239 }, { 483, 4240 }, { 505, 4275 }, { 506, 4276 }, { 507, 4277 }, { 508, 4278 }, { 509, 4318 }, { 510, 4319 }, { 511, 4320 }, { 520, 4326 }, { 521, 4327 }, { 522, 4328 }, { 523, 4329 }, { 524, 4330 }, { 525, 4331 }, { 526, 4332 }, { 527, 4333 }, { 179, 4349 }, { 180, 4350 }, { 181, 4351 }, { 182, 4352 }, { 183, 4353 }, { 381, 4354 }, { 531, 4355 }, { 532, 4364 }, { 533, 4376 }, { 534, 4377 }, { 536, 4378 }, { 538, 4380 }, { 539, 4389 }, { 484, 4390 }, { 162, 4391 }, { 541, 4392 }, { 542, 4396 }, { 543, 4398 }, { 544, 4399 }, { 545, 4420 }, { 546, 4422 }, { 547, 4430 }, { 548, 4435 }, { 552, 4460 }, { 550, 4461 }, { 551, 4462 }, { 553, 4473 }, { 554, 4474 }, { 555, 4475 }, { 556, 4476 }, { 558, 4481 }, { 559, 4483 }, { 563, 4547 }, { 565, 4552 }, { 564, 4553 }, { 561, 4554 }, { 562, 4564 }, { 560, 4599 }, { 567, 4609 }, { 67, 4640 }, { 66, 4641 }, { 63, 4642 }, { 65, 4643 }, { 64, 4644 }, { 68, 4645 }, { 566, 4646 }, { 568, 4655 }, { 569, 4656 }, { 570, 4657 }, { 572, 4695 }, { 573, 4710 }, { 574, 4717 }, { 575, 4718 }, { 576, 4719 }, { 577, 4720 }, { 578, 4721 }, { 579, 4761 }, { 580, 4846 }, { 581, 4848 }, { 582, 4850 }, { 590, 4851 }, { 591, 4858 }, { 592, 4867 }, { 593, 4868 }, { 594, 4869 }, { 595, 4871 }, { 597, 4875 }, { 598, 4880 }, { 599, 4882 }, { 600, 4883 }, { 601, 4884 }, { 602, 4885 }, { 603, 4886 }, { 604, 4887 }, { 605, 4888 }, { 606, 4889 }, { 607, 4890 }, { 608, 4891 }, { 609, 4892 }, { 610, 4893 }, { 611, 4894 }, { 612, 4895 }, { 613, 4904 }, { 614, 4906 }, { 615, 4907 }, { 617, 4924 }, { 618, 4962 }, { 619, 4963 }, { 620, 4964 }, { 622, 5008 }, { 444, 5066 }, { 485, 5067 }, { 623, 5081 }, };
        public static Dictionary<int, int> WallToItem = new Dictionary<int, int>() { { 1, 26 }, { 4, 93 }, { 5, 130 }, { 6, 132 }, { 10, 142 }, { 11, 144 }, { 12, 146 }, { 16, 30 }, { 17, 135 }, { 18, 138 }, { 19, 140 }, { 20, 330 }, { 22, 417 }, { 23, 418 }, { 24, 419 }, { 25, 420 }, { 26, 421 }, { 27, 479 }, { 29, 587 }, { 30, 592 }, { 31, 595 }, { 32, 605 }, { 33, 606 }, { 34, 608 }, { 35, 610 }, { 36, 615 }, { 37, 616 }, { 38, 617 }, { 39, 618 }, { 41, 622 }, { 42, 623 }, { 43, 624 }, { 44, 663 }, { 45, 720 }, { 46, 721 }, { 47, 722 }, { 60, 3584 }, { 66, 745 }, { 67, 746 }, { 68, 747 }, { 72, 750 }, { 73, 752 }, { 74, 764 }, { 75, 768 }, { 76, 769 }, { 77, 770 }, { 78, 1723 }, { 82, 825 }, { 84, 884 }, { 85, 927 }, { 88, 1267 }, { 89, 1268 }, { 90, 1269 }, { 91, 1270 }, { 92, 1271 }, { 93, 1272 }, { 100, 1378 }, { 101, 1379 }, { 102, 1380 }, { 103, 1381 }, { 104, 1382 }, { 105, 1383 }, { 106, 1447 }, { 107, 1448 }, { 108, 1126 }, { 109, 1590 }, { 110, 1592 }, { 111, 1594 }, { 112, 1102 }, { 113, 1726 }, { 114, 1728 }, { 115, 1730 }, { 116, 1948 }, { 117, 1949 }, { 118, 1950 }, { 119, 1951 }, { 120, 1952 }, { 121, 1953 }, { 122, 1954 }, { 123, 1955 }, { 124, 1956 }, { 125, 1957 }, { 126, 2008 }, { 127, 2009 }, { 128, 2010 }, { 129, 2011 }, { 130, 2012 }, { 131, 2013 }, { 132, 2014 }, { 133, 2158 }, { 134, 2159 }, { 135, 2160 }, { 136, 2169 }, { 137, 2170 }, { 138, 2210 }, { 139, 2211 }, { 140, 2212 }, { 141, 2213 }, { 142, 2263 }, { 143, 2264 }, { 144, 2271 }, { 145, 2333 }, { 146, 2432 }, { 147, 2433 }, { 148, 2434 }, { 149, 2505 }, { 150, 2507 }, { 151, 2506 }, { 152, 2508 }, { 153, 2677 }, { 154, 2679 }, { 155, 2681 }, { 156, 2683 }, { 157, 2678 }, { 158, 2680 }, { 159, 2682 }, { 160, 2684 }, { 161, 2686 }, { 162, 2688 }, { 163, 2690 }, { 164, 2685 }, { 165, 2687 }, { 166, 2689 }, { 167, 2691 }, { 168, 2696 }, { 169, 2698 }, { 172, 2788 }, { 173, 2789 }, { 174, 2790 }, { 175, 2791 }, { 176, 2861 }, { 177, 3067 }, { 179, 3083 }, { 181, 3089 }, { 182, 3101 }, { 183, 3082 }, { 184, 3088 }, { 186, 3238 }, { 224, 3472 }, { 225, 3751 }, { 226, 3752 }, { 227, 3753 }, { 228, 3760 }, { 229, 3761 }, { 230, 3762 }, { 231, 3952 }, { 232, 3954 }, { 233, 3956 }, { 234, 4052 }, { 235, 4053 }, { 236, 4140 }, { 237, 4233 }, { 238, 4234 }, { 239, 4235 }, { 240, 4236 }, { 241, 4260 }, { 242, 4279 }, { 243, 4280 }, { 245, 4424 }, { 246, 4486 }, { 247, 4487 }, { 248, 4488 }, { 249, 4489 }, { 250, 4490 }, { 251, 4491 }, { 252, 4492 }, { 253, 4493 }, { 254, 4494 }, { 255, 4495 }, { 256, 4496 }, { 257, 4497 }, { 258, 4498 }, { 259, 4499 }, { 260, 4500 }, { 261, 4501 }, { 262, 4502 }, { 263, 4503 }, { 264, 4504 }, { 265, 4505 }, { 266, 4506 }, { 267, 4507 }, { 268, 4508 }, { 269, 4509 }, { 270, 4510 }, { 271, 4511 }, { 274, 4512 }, { 275, 3273 }, { 276, 4513 }, { 277, 4514 }, { 278, 4515 }, { 279, 4516 }, { 280, 4517 }, { 281, 4518 }, { 282, 4519 }, { 283, 4520 }, { 284, 4521 }, { 285, 4522 }, { 286, 4523 }, { 287, 4524 }, { 288, 4525 }, { 289, 4526 }, { 290, 4527 }, { 291, 4528 }, { 292, 4529 }, { 293, 4530 }, { 294, 4531 }, { 295, 4532 }, { 296, 4533 }, { 297, 4534 }, { 298, 4535 }, { 299, 4536 }, { 300, 4537 }, { 301, 4538 }, { 302, 4539 }, { 303, 4540 }, { 304, 3340 }, { 305, 3341 }, { 306, 3342 }, { 307, 3343 }, { 308, 3344 }, { 309, 3345 }, { 310, 3346 }, { 311, 3348 }, { 312, 4565 }, { 313, 4548 }, { 314, 4647 }, { 315, 4667 }, };

        public static Color[] paintToColor = new Color[31];

        public static Color[] colorLookup;
        public static ushort[] wallLookup;
        public static ushort[] tileLookup;


        public static Color[] tileColorLookup;
        public static Color[] wallColorLookup;

        public static Color GetWallColor(int type, int paint = 0)
        {
            Color wallColor = wallColorLookup[type];
            switch (paint)
            {
                case 30:
                    {
                        wallColor.R = (byte)((255 - wallColor.R) / 2);
                        wallColor.G = (byte)((255 - wallColor.G) / 2);
                        wallColor.B = (byte)((255 - wallColor.B) / 2);
                    }
                    break;
                case 31:
                case 0:
                    break;
                default:
                    {
                        Color color = paintToColor[paint];

                        float num = (float)(int)wallColor.R / 255f;
                        float num2 = (float)(int)wallColor.G / 255f;
                        float num3 = (float)(int)wallColor.B / 255f;
                        if (num2 > num)
                        {
                            float num4 = num;
                            num = num2;
                        }
                        if (num3 > num)
                        {
                            float num5 = num;
                            num = num3;
                        }
                        float num6 = num;
                        wallColor.R = (byte)((float)(int)color.R * num6);
                        wallColor.G = (byte)((float)(int)color.G * num6);
                        wallColor.B = (byte)((float)(int)color.B * num6);
                        break;
                    }
            }
            return wallColor;
        }
        public static Color GetTileColor(int type, int paint = 0)
        {
            Color tileColor = tileColorLookup[type];

            switch (paint)
            {
                case 30:
                    {
                        tileColor.R = (byte)(255 - tileColor.R);
                        tileColor.G = (byte)(255 - tileColor.G);
                        tileColor.B = (byte)(255 - tileColor.B);
                    }
                    break;
                case 0:
                    break;
                default:
                    {
                        Color color = paintToColor[paint];

                        float num = (float)(int)tileColor.R / 255f;
                        float num2 = (float)(int)tileColor.G / 255f;
                        float num3 = (float)(int)tileColor.B / 255f;
                        if (num2 > num)
                        {
                            float num4 = num;
                            num = num2;
                        }
                        if (num3 > num)
                        {
                            float num5 = num;
                            num = num3;
                        }
                        float num6 = num;
                        tileColor.R = (byte)((float)(int)color.R * num6);
                        tileColor.G = (byte)((float)(int)color.G * num6);
                        tileColor.B = (byte)((float)(int)color.B * num6);
                        break;
                    }
            }
            return tileColor;
        }
        static TileUtil()
        {

        }

        private static void LoadPrivateArrays()
        {
            colorLookup = (Color[])((Color[])typeof(Terraria.Map.MapHelper).GetField("colorLookup", BindingFlags.Static | BindingFlags.NonPublic).GetValue(null)).Clone();
            wallLookup = (ushort[])((ushort[])typeof(Terraria.Map.MapHelper).GetField("wallLookup", BindingFlags.Static | BindingFlags.Public).GetValue(null)).Clone();
            tileLookup = (ushort[])((ushort[])typeof(Terraria.Map.MapHelper).GetField("tileLookup", BindingFlags.Static | BindingFlags.Public).GetValue(null)).Clone();
        }
        private static void LoadDefaultData()
        {


            tileColorLookup = new Color[tileLookup.Length];
            wallColorLookup = new Color[wallLookup.Length];

            for (int i = 0; i < tileColorLookup.Length; i++)
            {
                tileColorLookup[i] = colorLookup[tileLookup[i]];
            }

            for (int i = 0; i < wallColorLookup.Length; i++)
            {
                wallColorLookup[i] = colorLookup[wallLookup[i]];
            }

            for (int i = 0; i < paintToColor.Length; i++)
            {
                paintToColor[i] = WorldGen.paintColor(i);
            }
        }

        public static void Init()
        {
            LoadPrivateArrays();
            LoadDefaultData();
        }
    }
}
